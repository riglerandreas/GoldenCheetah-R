---
title: "compare_seasons"
author: "ari"
date: "29 10 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}

library(tidyverse)
library(lubridate)
```

#Import data
```{r}
path_laktat_ftp <- "C:/Users/rigle/Documents/Training/Laktat FTP/"


training_data_season <-read_rds(str_c(path_laktat_ftp,"Results/season_data_count.rds"))

training_watt_count_season <- read_rds(str_c(path_laktat_ftp,"Results/season_watt_count.rds"))
training_hr_count_season <- read_rds(str_c(path_laktat_ftp,"Results/season_hr_count.rds"))
```

## Hier weitermachen:
- warum gibt es diese ausreißer?
- gibt es zusammenhänge
- relative zahlen machen
- mit ftp verbinden ( rel zu anfangs ftp oder ftp zu diesem zeitpunkt als referenz verwenden)
- X TAGE der season filtern siehe season 2021 - kann fast nicht sein? --> herausfinden wo relevanter bereich liegt
- z.B: Kennzahlen z.B. Zonen -> verädnerung über Monate

```{r}
watt_count_season <- training_watt_count_season %>% group_by(season,end_ftp, watt) %>% 
                            summarise(n = sum(n, na.rm = TRUE)) %>%
                                arrange(watt) #%>%
                                    #mutate(n = if_else(n-lag(n)> 1000L, (lag(n)+lead(n))/2,n))

watt_count_season %>% 
  filter(watt %in% c(50:350) &
           n < 10000 &
           str_detect(season, "2021")) %>%
  ggplot() +
  geom_point(aes(x=watt, y = n,color =as.factor(end_ftp)),stat="identity")
```



```{r}
training_data_season %>% group_by(season) %>% 
                              summarise(end_ftp = max(end_ftp),
                                        date = max(date)) %>%
  ggplot(aes(x=date))+
  geom_line(aes(y=end_ftp))
```

Jump in 2017 ist sehr interessant. Ende März schon auf 282W. Januar war noch auf 260W. Wie ist das möglich?

```{r}
training_data_season %>% filter(#season %in% c("2017_Januar", "2017_Maerz", "2020_Juni","2021_April") &
                                  day_season >100)%>%
ggplot() +
  geom_density(aes(x=NP, color =as.factor(end_ftp)))
```

```{r}
training_data_season %>% filter(day_season >50)%>%
  group_by(season) %>% summarise(movement_time_sec = sum(movement_time_sec, na.rm = TRUE),
                                 time_2mmol = sum(time_2mmol,na.rm= TRUE),
                                 time_4mmol = sum(time_4mmol,na.rm= TRUE),
                                 end_ftp = max(end_ftp)) %>% 
                          mutate(time_between = movement_time_sec - time_2mmol - time_4mmol) %>% arrange(end_ftp)
  
ggplot() +
  geom_density(aes(x=time_2mmol, color =as.factor(end_ftp)))
```

```{r}
training_data_season %>% filter(day_season >100)%>%
ggplot() +
  geom_density(aes(x=NP, color =as.factor(season)))+
  facet_wrap(.~ end_ftp)+
  geom_vline(xintercept = 220)
```
